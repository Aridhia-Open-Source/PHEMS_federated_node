suite: Missing secrets failures
release:
  namespace: federatednode
  name: federatednode
values:
  - ../values/values-aks.yaml
kubernetesProvider:
  scheme:
    v1/Secret:
      gvr:
        version: v1
        resource: secrets
      namespaced: true
    v1/ConfigMap:
          gvr:
            version: v1
            resource: configmaps
          namespaced: true
  objects:
    - apiVersion: v1
      kind: ConfigMap
      metadata:
        name: azurecert-config
        namespace: federatednode
      data:
        EMAIL_CERT: test@test.com
        SP_ID: as1d1as351as
        RG_NAME: rg-test
        SUBSCRIPTION_ID: 123-123-123
        HOSTED_ZONE: uksouth
        TENANT_ID: as13151cv18a1ca651ac
tests:
  - it: fails without expected db secret
    template: copy-secrets.yaml
    asserts:
      - failedTemplate:
          errorMessage: Secret local-db not found in namespace federatednode
  - it: fails without expected azure storage secret
    template: copy-secrets.yaml
    set:
      storage:
        azure:
          secretName: new-az-secret
    kubernetesProvider:
      objects:
        - apiVersion: v1
          kind: Secret
          metadata:
            name: local-db
            namespace: federatednode
          type: Opaque
          data:
            password: dGVzdA==
    asserts:
      - failedTemplate:
          errorMessage: Secret new-az-secret not found in namespace federatednode
  - it: fails without expected azure certs secret
    template: copy-secrets.yaml
    set:
      certs:
        azure:
          secretName: new-az-secret
    kubernetesProvider:
      objects:
        - apiVersion: v1
          kind: Secret
          metadata:
            name: local-db
            namespace: federatednode
          type: Opaque
          data:
            password: dGVzdA==
        - apiVersion: v1
          kind: Secret
          metadata:
            name: test-azure
            namespace: federatednode
          type: Opaque
          data:
            SP_SECRET: dGVzdA==
    asserts:
      - failedTemplate:
          errorMessage: Secret new-az-secret not found in namespace federatednode
